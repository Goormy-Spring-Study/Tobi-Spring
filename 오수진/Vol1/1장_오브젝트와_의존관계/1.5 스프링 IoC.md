1.5 스프링 IoC
=
## 1.5.1 오브젝트 팩토리를 이용한 스프링 IoC
### 애플리케이션 컨텍스트와 설정정보
#### 스프링 빈
- 스프링이 제어권을 가지고 직접 만들고 관계를 부여하는 오브젝트
- 제어의 역전이 적용된 오브젝트

#### 빈 팩토리, 애플리케이션 컨텍스트
- 빈의 생성과 관계설정 같은 제어를 담당하는 IoC 오브젝트
- 어플리케이션 컨텍스트를 주로 사용하는데, 빈 팩토리를 상속하는 인터페이스로 부가 기능을 가진다. 
- 책에서는 같은 걸로 간주 (IoC 오브젝트로서의 역할에 초점)

#### 설정정보
- 어떤 오브젝트를 생성할 지, 어디에서 사용하도록 연결할 지에 대한 정보
- 애플리케이션 컨텍스트는 이런 설정 정보를 직접 갖고 있지 않고 이를 담고 있는 것을 가져와 활용하는 범용적인 엔진

### DaoFactory를 사용하는 애플리케이션 컨텍스트
#### DaoFactory를 스프링이 사용하는 설정정보로 만들기
1. @Configuration 어노테이션을 붙여 스프링이 설정 정보 오브젝트라고 인식할 수 있도록 함
2. 오브젝트를 리턴하는 메소드 위에 @Bean을 붙임
```java
@Configuration
public class DaoFactory {

    @Bean
    public UserDao userDao() {
        return new UserDao(connectionMaker());
    }

    @Bean
    public ConnectionMaker connectionMaker() {
        return new DConnectionMaker();
    }
}
```
#### 애플리케이션 컨텍스트 만들기
- ApplicationContext 타입의 오브젝트
- 어노테이션 기반 설정 정보를 사용하기 위해서 AnnotationConfigApplicationContext 구현체로 생성
- 생성자 파라미터로 설정정보인 DaoFactory 클래스 넣어줌
- 애플리케이션 컨텍스트의 getBean() 메소드를 사용하여 오브젝트를 가져올 수 있음

```java
import java.sql.SQLException;

public class UserDaoTest {
    public static void main(String[] args) throws SQLException {
        ApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);
        UserDao dao = context.getBean("userDao", UserDao.class);
    }
}
```
#### getBean의 파라미터
- 빈의 이름
  - 설정 정보에서 오브젝트를 생성하는 메소드의 이름이 빈의 이름이 됨
  - 클래스를 생성하는 방식이나 구성이 다른 여러 빈이 존재할 수 있기 때문
- 클래스
  - getBean()은 Object 타입을 리턴해서 매번 리턴 오브젝트를 캐스팅해주어야 했음
  - 자바 5에서부터 getBean()의 두 번째 파라미터에 리턴타입을 주면 타입 캐스팅 과정이 필요없음

[참고]
1. getBean(빈 이름, 클래스)
   - 캐스팅 불필요
2. getBean(빈 이름)
    - 이 경우 캐스팅이 필요
3. getBean(클래스)
   - 해당 타입의 빈이 하나만 있을 경우 사용 가능

## 1.5.2 애플리케이션 컨텍스트의 동작방식
### 애플리케이션 컨텍스트
- IoC 컨텍스트, 스프링 컨테이너, 빈 팩토리, 스프링 등으로 불림
- Dao의 설계 담당하던 DaoFactory 와는 달리 애플리케이션 컨텍스트는 애플리케이션에서 IoC를 적용해서 관리할 모든 오브젝트에 대한 설계를 담당
- 대신, @Configuration 어노테이션을 붙인 외부 오브젝트 팩토리에 설정정보를 위임

![image](https://github.com/user-attachments/assets/b8d33121-d9db-454c-8c14-74e8a7dd4ce9)
- DaoFactory 클래스를 설정정보로 등록두고 @Bean이 붙은 메소드의 이름을 가져와 빈 목록을 만듦 
- 클라이언트가 getBean()을 호출하면 빈 목록에서 조회
- 있으면 빈 생성 메소드 호출해서 오브젝트를 생성하고 클라이언트에게 돌려줌

### 애플리케이션 컨텍스트 사용의 장점
#### 1. 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없다.
- IoC를 적용해야 할 오브젝트가 많아지면 팩토리 클래스도 늘어날 것. 
- 클라이언트는 구체적인 팩토리 클래스를 알 필요 없이 범용적인 애플리케이션 컨텍스트를 사용
- 일관된 방식으로 오브젝트를 가져올 수 있다. 

#### 2. 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공한다. 
- 오브젝트 생성 방식, 시점, 전략 등을 다르게 설정
- 자동생성, 오브젝트 후처리, 정보의 조합, 설정 방식의 다변화, 인터셉팅 등 다양한 기능 제공
- 빈이 사용할 수 있는 기반 기술 서비스, 외부 시스템과의 연동을 컨테이너 차원에서 제공

#### 3. 애플리케이션 컨텍스트는 빈을 검색하는 다양한 방법을 제공한다.
- 빈의 이름으로 검색, 타입만으로 검색, 특별한 애노테이션 설정된 빈 검색 등

## 1.5.3 스프링 IoC의 용어 정리
### 빈
- 스프링이 IoC 방식으로 관리하는 오브젝트
- 주의 : 모든 오브젝트가 빈은 아님

### 빈 팩토리
- 스프링의 IoC를 담당하는 핵심 컨테이너
- 빈 등록, 생성, 조회, 반환, 부가적인 빈 관리 기능 담당
- 주로 빈 팩토리를 확장한 애플리케이션 컨텍스트를 사용

### 애플리케이션 컨텍스트
- 빈 팩토리를 확장한 IoC 컨테이너
- 빈 등록, 관리 등의 기본적인 기능은 빈 팩토리와 동일
- 각종 부가 서비스를 추가로 제공

### 빈 팩토리 & 애플리케이션 컨텍스트
- 빈 팩토리 : 빈의 생성과 제어의 관점
- 애플리케이션 컨텍스트 : 스프링이 지원하는 애플리케이션 지원 기능을 모두 포함

### 설정정보/설정 메타정보
- 애플리케이션 컨텍스트가 IoC를 적용하기 위해 사용하는 메타정보

### 컨테이너 또는 IoC 컨테이너
- IoC 방식으로 빈을 관리한다는 의미에서 애플리케이션 컨텍스트를 컨테이너 또는 IoC 컨테이너라고도 함
- IoC 컨테이너라고 부를 때는 빈 팩토리의 관점
- 컨테이너 또는 스프링 컨테이너라고 부를 때는 애플리케이션 컨텍스트의 관점

### 스프링 프레임워크
- IoC 컨테이너, 애플리케이션 컨텍스트를 포함해서 스프링이 제공하는 모든 기능을 통틀어 말할 때 사용
- 스프링이라고 말하기도 함




