2.1 공통 개념 
=
- 모든 기술에 공통적으로 적용되는 원칙과 기본 개념
## DAO 패턴
- DTO 또는 도메인 오브젝트만을 사용하는 인터페이스를 통해 데이터 엑세스 기술을 외부에 노출하지 않도록 만드는 것
- 코드에 영향을 주지 않고 데이터 접근 기술 변경 & 하나 이상의 기술 사용을 가능하게 해줌
- 순수한 POJO로 개발할 수 있도록 해줌
- 목 오브젝트를 사용하여 단위 테스트 가능

### DAO 인터페이스와 DI
- 인터페이스를 이용해 접근하고 DI 되도록 만들어야
-  인터페이스를 만들 때,
  - 구체적 기술 노출 X
  - 모든 public 메소드를 추가하는 습관 X -> Service 계층에서 의미 있는 메소드만 공개해야
  - 특정 기술에만 의미있는 이름 X (ex. JPA의 persist(), merge() 등)

### 예외처리
- 데이터 접근 중 발생한 에러는 복구 불가능하기 때문에 런타임 예외여야
- 또한, DAO 메소드 선언부에
  - `throws SQLException` 같은 기술을 노출하는 예외처리 x
  - `throws Exception` 같은 무책임한 예외처리도 x
- DAO가 던지는 대부분의 예외는 서비스 계층 코드가 다뤄야 할 이유가 없는 예외
- but, 때로는 의미 있는 예외를 잡아서 로직에 적용하는 경우가 있음 (ex. 중복키 예외, 낙관적인 락킹 등)
- 이때, 기술마다 던지는 예외에 일관성이 없기 때문에 서비스 계층에서 이를 알고 있어야 한다는 문제 발생
- 스프링은 이를 위해 예외 추상화 제공하여 각 기술의 예외를 스프링의 데이터 예외로 변환해주는 변환 서비스를 제공
- 데이터 기술의 API를 직접 사용할 때는 AOP를 이용해 예외를 전환해주는 기능을 사용
- 최신 데이터 접근 기술을 JDBC와 다르게 런타임 예외 사용

## 2.1.2 템플릿과 API
- 데이터 접근 기술은 대부분 try/catch/finally & 반복되는 코드
- 외부 리소스와 연동 과정에서 발생하는 예외에서도 리소스 반환코드 필요하기 때문
- 스프링은 템플릿/콜백 패턴을 이용해 템플릿을 제공 -> 반복 코드 제거, 예외 변환, 트랜잭션 동기화
- 단점
  - 템플릿이 제공하는 API 사용해야 함 (특정 데이터 접근 기술이 제공하는 고유한 기능이나 확장 API를 사용하려면 템플릿이 이를 지원하지 않을 수 있음)
  - 콜백 오브젝트를 익명 내부 클래스로 작성해야 하는 경우 -> 가독성↓
- 따라서, 스프링은 일부 데이터 접근 기술을 API 그대로 사용할 수 있도록 제공
- 데이터 접근 기술이 제공하는 확장 기법과 API 등을 이용해 예외 변환과 트랜잭션 동기화 제공 가능하기 때문

## 2.1.3 DataSource
- Connection은 모든 데이터 접근 기술에서 사용되는 필수 리소스임
- 사용자의 요청이 빈번하게 일어나는 엔터프라이즈 환경에서 각 요청마다 커넥션을 매번 새롭게 만드는 것은 비효율적이며 성능하락
- 커넥션을 pool에 미리 준비해두고, 할당하는 풀링 기법 사용
- 스프링은 DataSource를 빈으로 등록하고 관리하기 위해 데이터 접근 기술이 자체적인 생성 방식을 사용하는 대신 스프링 빈으로 등록된 DataSource를 사용하는데 필요한 방법을 제공한다. 

### 스프링에서 사용하는 DataSource의 종류
### 학습 테스트와 통합 테스트를 위한 DataSource
- 순차적으로 진행하는 통합 테스트나 단순한 학습 테스트
- 스프링이 제공하는 단순한 DataSource 사용
- but 운영환경에서는 절대 사용 x
  - 설정파일을 환경별로 따로 만들어 사용 권장
#### 1. SimpleDriverDataSource
- 가장 단순한 DataSource
- 풀 관리 x, 매번 생성
#### 2. SingleConnectionDataSource
- 하나의 물리적 Connection을 계속 사용
- 순차적, 독립적 o / 멀티 스레드 x
- 매번 생성 x -> SimpleDriverDataSource 보다 빠름

### 오픈소스 또는 사용 DB 커넥션 풀
- 서버의 DB 풀로 등록해서 사용 가능하지만 일반적으로 애플리케이션 레벨에서 애플리케이션 전용 DB 풀을 만들어 사용
- 두 오픈소스 DBCP 모두 스프링 빈으로 바로 등록해서 사용 가능한 수정자 메소드를 가진 클래스가 제공되어 사용이 편리
- 다양한 풀 클래스와 설정 옵션 제공
#### 1-1. 아파치 Commons DBCP
- 가장 유명
#### 1-2. c3p0 JDBC/DataSource Resource Pool
- JDBC 3.0 스펙을 준수하는 Connection과 Statement 풀을 제공하는 라이브러리
#### 2. 상용 DB 커넥션 풀
- 일부 상용 DB는 자체적으로 커넥션 풀 라이브러리를 제공

### JDNI/WAS DB 풀
- 대부분의 자바 서버는 자체적으로 DB 풀 서비스 제공
- 서버가 제공하는 DB풀을 사용 하는 경우 JNDI를 사용
- 주의: JNDI로 가져오는 빈 오브젝트는 서버 밖에서는 제대로 동작 x -> 스프링 테스트 프레임워크는 JNDI 목 오브젝트를 제공 (`SimpleNamingContextBuilder`)



## JNDI(Java Naming and Directory Interface)
- Java에서 네트워크나 디렉토리 서비스와 같은 리소스에 접근하기 위한 표준 API
- JNDI는 복잡한 리소스 연결을 쉽게 해주기 때문에, 주로 애플리케이션 서버에서 데이터베이스, 메시지 큐, 원격 서비스 등의 리소스를 관리하고 연결할 때 사용


### JNDI는 무엇을 하는가?
- 데이터베이스 연결, 메시징 서비스, EJB(Enterprise Java Beans) 등과 같은 리소스의 이름(Name)을 통해 애플리케이션이 해당 리소스를 찾을 수 있도록 도와 줌
- 리소스를 추상화하여 사용자가 직접 리소스를 관리하거나 설정하지 않도록 도와 줌

### 왜 사용하는가?
- 리소스를 코드에 직접 하드코딩하지 않기 위해.
- 환경(개발, 테스트, 운영)에 따라 리소스 설정이 다를 수 있는데, JNDI를 사용하면 설정을 중앙화하고 관리하기 쉬워짐

### JNDI 작동 방식
#### 1. 리소스 등록
- 애플리케이션 서버(예: Tomcat, WildFly)는 데이터베이스 커넥션 풀, JMS 큐, 이메일 세션 등 다양한 리소스를 JNDI 네이밍 서비스에 등록
- 각 리소스는 고유한 이름(예: java:/comp/env/jdbc/myDataSource)으로 식별
#### 2. 리소스 검색
- 애플리케이션은 JNDI를 통해 이름으로 리소스를 조회
- JNDI는 이 요청을 처리하여 리소스 객체를 반환