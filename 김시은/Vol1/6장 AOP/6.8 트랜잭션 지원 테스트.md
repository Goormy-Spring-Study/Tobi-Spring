6.8 트랜잭션 지원 테스트
=
## 6.8.1 선언적 트랜잭션과 트랜잭션 전파 속성
- 트랜잭션 전파 속성: 트랜잭션 전파 속성은 메서드 간에 트랜잭션을 어떻게 이어갈 것인지 또는 새로운 트랜잭션을 시작할 것인지를 정의한다. 
이 속성을 통해 여러 메서드가 하나의 트랜잭션 안에서 처리될지, 각각의 트랜잭션으로 분리될지를 설정할 수 있다. 
예를 들어 REQUIRED 속성은 기존 트랜잭션이 있을 경우 참여하고, 없을 경우 새 트랜잭션을 시작한다. 반면 REQUIRES_NEW는 항상 새로운 트랜잭션을 생성한다.
- 트랜잭션 경계 설정: 트랜잭션의 시작과 종료는 매우 중요하다. 메서드가 실행될 때 트랜잭션이 시작되고, 메서드가 끝날 때 트랜잭션이 커밋되거나 롤백된다. 
트랜잭션이 언제 시작되고 끝나는지 명확히 정의하면, 데이터의 일관성과 무결성을 보장할 수 있다.
- 트랜잭션 전파 속성 테스트: 트랜잭션 전파 속성을 테스트할 수 있다. 
@Transactional(propagation = Propagation.REQUIRED)와 같은 설정을 통해 메서드가 트랜잭션 내에서 적절히 동작하는지 확인할 수 있다.

## 6.8.2 트랜잭션 동기화와 테스트
- 트랜잭션 동기화: 스프링 프레임워크에서는 PlatformTransactionManager를 통해 트랜잭션을 관리하며, 
여러 데이터 소스에서 동시 작업을 처리할 수 있도록 트랜잭션 동기화를 지원한다. 
이는 테스트 시에도 유용하며, 각 메서드가 트랜잭션 내에서 예상대로 동작하는지 확인할 수 있다.
- 트랜잭션 테스트 설정: 트랜잭션이 적절히 동작하는지 테스트하는 것은 중요하다. 
예를 들어, 데이터 수정 작업 중 오류가 발생하면 롤백되는지 확인하거나, 읽기 전용 트랜잭션에서 수정 작업을 시도할 때 예외가 발생하는지 검증할 수 있다.

## 6.8.3 테스트를 위한 트랜잭션 애노테이션
- @Transactional 애노테이션: 테스트에서도 @Transactional을 사용해 트랜잭션을 간편하게 설정할 수 있다. 
이 애노테이션을 사용하면 트랜잭션이 테스트 메서드에서 시작되고, 메서드가 종료될 때 커밋되거나 롤백된다.
- @Rollback 애노테이션: 테스트에서 자동으로 트랜잭션을 롤백할 수 있는 애노테이션이다. 
이를 통해 테스트 중에 발생한 트랜잭션이 DB에 영향을 미치지 않고 테스트가 끝나면 데이터를 원래 상태로 복구할 수 있다.
- 테스트 코드 작성 예시:
```java
@Test
@Transactional
@Rollback(true)
public void testTransaction() {
    userService.deleteAll();
    userService.add(users.get(0));
    assertThat(userService.getAll().size(), is(1));
}
```

이 예시에서는 트랜잭션이 시작되고, 모든 작업이 완료된 후 트랜잭션이 롤백되어 데이터가 원래 상태로 복구된다.

## 6.8.4 트랜잭션 매니저와 테스트용 트랜잭션 제어
- 트랜잭션 매니저 사용: 테스트에서는 PlatformTransactionManager를 사용해 트랜잭션을 수동으로 시작하거나 종료할 수 있다. 
이는 테스트 환경에서 복잡한 트랜잭션 시나리오를 정확하게 제어하는 데 유용하다.
- 테스트 결과 검증: 트랜잭션을 테스트한 후 데이터가 예상대로 변경되었는지, 롤백이 제대로 이루어졌는지 검증하는 것이 중요하다. 
이를 통해 트랜잭션 관리가 올바르게 동작하는지 확인할 수 있다.