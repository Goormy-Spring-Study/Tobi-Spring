1.6 싱글톤 레지스트리와 오브젝트 스코프
=
## .6.1 싱글톤 레지스트리로서의 애플리케이션 컨텍스트
- 애플리케이션 컨텍스트: 스프링의 애플리케이션 컨텍스트는 싱글톤을 저장하고 관리하는 싱글톤 레지스트리로 기능한다. 
스프링은 기본적으로 애플리케이션 내에서 생성하는 대부분의 빈을 싱글톤으로 관리하여, 동일한 빈을 요청할 때마다 같은 인스턴스를 반환한다.
- 싱글톤 패턴: 특정 클래스가 애플리케이션 내에서 단 하나의 인스턴스만 가지도록 보장하는 디자인 패턴이다. 스프링은 이 패턴을 활용하여 자원 낭비를 줄이고, 일관성을 유지한다.

### 싱글톤 패턴을 적용한 UserDao 예시
```java
public class UserDao {
private static UserDao INSTANCE;
private ConnectionMaker connectionMaker;

    private UserDao(ConnectionMaker connectionMaker) {
        this.connectionMaker = connectionMaker;
    }

    public static synchronized UserDao getInstance() {
        if (INSTANCE == null) {
            INSTANCE = new UserDao(??);
        }
        return INSTANCE;
    }
    ...
}
```

### 일반적인 싱글톤 패턴의 문제점
- 상속의 제한: private 생성자를 가지므로 다른 클래스에서 상속할 수 없으며, 이는 다형성 적용이 불가능함을 의미한다.
- 테스트의 어려움: 싱글톤은 오브젝트 생성 방식이 제한적이기 때문에, 테스트 시 목 오브젝트 등으로 대체하기 어려우며, 필요한 오브젝트를 직접 만들어야 하는 불편함이 있다.
- 서버 환경에서의 불확실성: 클래스 로더의 구성에 따라, 싱글톤 클래스임에도 불구하고 하나 이상의 오브젝트가 생성될 수 있는 위험이 존재한다.
- 전역 상태 문제: 싱글톤의 static 메서드로 인해 애플리케이션 어디서든지 접근할 수 있어 전역 상태를 만들기 쉽다. 이는 의도치 않은 부작용을 초래할 수 있다.

### 싱글톤 레지스트리
- 스프링의 관리: 스프링은 직접 싱글톤 형태의 오브젝트를 생성하고 관리할 수 있는 기능을 제공한다. 이를 통해 평범한 자바 클래스라도 싱글톤으로 관리될 수 있으며,
IoC 컨테이너를 통해 생성과 관계 설정 등의 제어권을 컨테이너가 가지게 한다.
- 장점: 스프링을 이용하면 public 생성자를 통해 간단히 오브젝트를 생성할 수 있으며, 테스트 환경에서도 자유롭게 오브젝트를 생성하여 사용할 수 있다. 이는 싱글톤 패턴의 일반적인 단점을 보완한다.

## 1.6.2 싱글톤과 오브젝트의 상태
### 싱글톤의 무상태성(stateless)
- 무상태 유지: 싱글톤은 멀티스레드 환경에서 동시에 여러 스레드가 접근할 수 있기 때문에, 인스턴스 변수에 상태 정보를 유지하지 않는 것이 중요하다.
- 상태 관리의 위험성: 다중 사용자 요청을 처리하는 스레드들이 싱글톤 오브젝트의 인스턴스 변수를 수정하는 경우, 서로 다른 요청이 동일한 변수를 덮어쓰거나 읽어오게 되어 예기치 않은 오류가 발생할 수 있다.
- 읽기 전용 상태: 만약 상태가 변경되지 않는 읽기 전용이라면 문제가 없으며, 이 경우 static final이나 final로 선언하는 것이 바람직하다.

## 1.6.3 스프링 빈의 스코프
### 빈의 스코프 정의
- 스코프: 스프링에서 빈의 스코프는 해당 빈이 생성되고 존재하며, 적용되는 범위를 의미한다. 기본적으로 스프링 빈은 싱글톤 스코프를 가지며, 
이는 컨테이너 내에서 한 개의 오브젝트만 생성되어 애플리케이션 전반에 걸쳐 사용된다는 것을 의미한다.
- 다양한 스코프: 스프링은 필요에 따라 여러 가지 스코프를 제공한다. 
예를 들어, 프로토타입 스코프는 매번 빈을 요청할 때마다 새로운 인스턴스를 생성하고, request와 session 스코프는 웹 애플리케이션에서 요청이나 세션에 따라 빈의 생명주기를 관리한다.

### 요약
스프링의 싱글톤 레지스트리는 애플리케이션 전반에서 자원을 효율적으로 관리하고, 전역 상태를 최소화하여 애플리케이션의 안정성을 높인다.
또한, 다양한 스코프를 제공함으로써 각기 다른 요구 사항에 맞게 객체의 생명주기를 유연하게 관리할 수 있다.
이를 통해 스프링은 개발자가 더욱 간결하고 유지보수하기 쉬운 코드를 작성할 수 있도록 돕는다.