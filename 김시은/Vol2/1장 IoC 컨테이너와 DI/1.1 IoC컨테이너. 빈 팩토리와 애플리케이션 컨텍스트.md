1.1 IoC 컨테이너: 빈 팩토리와 애플리케이션 컨텍스트
=
- 스프링 애플리케이션에서는 오브젝트의 생성과 관계설정, 사용, 제거 등의 작업을 애플리케이션 코드 대신 독립된 컨테이너가 담당한다.
- 이를 컨테이너가 코드 대신 오브젝트에 대한 제어권을 갖고 있다고 해서 IoC라고 부른다. 그래서 스프링 컨테이너를 IoC 컨테이너라고도 한다.
- 애플리케이션 컨텍스트는 그 자체로 IoC와 DI를 위한 빈 팩토리이면서 그 이상의 기능을 가졌다고 보면 된다.
- 실제로 스프링 컨테이너 또는 IoC 컨테이너라고 말하는 것은 바로 이 ApplicationContext 인터페이스를 구현한 클래스의 오브젝트다.

## 1.1.1 IoC 컨테이너를 이용해 애플리케이션 만들기

- 가장 간단하게 IoC 컨테이너를 만드는 방법: ApplicationContext 구현 클래스의 인스턴스를 만드는 것
```java
StaticApplicationContext ac = new StaticApplicationContext();
```

### POJO 클래스
- 애플리케이션의 핵심 코드를 담고 있는 POJO 클래스를 준비해야 한다.
![image](https://github.com/user-attachments/assets/765da807-b22f-4e09-a832-ff46426eb5f9)
- [POJO의 클래스 다이어그램]
```java
public class Hello {
    String name;
    Printer printer;
    
    public String sayHello() {
        return "Hello " + name;
    }
    
    public voic print() {
        this.printer.print(sayHello());
    }
    
    public void sayName(String name) {
        this.name = name;
    }
    
    public void setPrinter(Printer printer) {
        this.printer = printer;
    }
}
```

- 각각 기능에 충실하게 독립적으로 설계된 POJO 클래스를 만들고, 결합도가 낮은 유연한 관계를 가질 수 있도록 인터페이스를 이용해 연결해주는 것까지가 IoC 컨테이너가 사용할 POJO를 준비하는 첫 단계다.

### 설정 메타정보
- 앞에서 만든 POJO 클래스 중에 애플리케이션에서 사용할 것을 선정하고 이를 IoC 컨테이너가 제어할 수 있도록 적절한 메타정보를 만들어 제공하는 작업이 필요하다.
- IoC 컨테이너의 가장 기초적인 역할은 오브젝트를 생성하고 이를 관리하는 것인데, 스프링 컨테이너거ㅏ 관리하는 이런 오브젝트는 Bean이라고 부른다.
- IoC 컨테이너가 필요로 하는 설정 메타정보는 바로 이 빈을 어떻게 만들고 어떻게 동작하게 할 것인가에 관한 정보다.
- 스프링의 설정 메타정보는 XML 파일이 아니라, BeanDefinition 인터페이스로 표현되는 순수한 추상정보다.
- 스프링 IoC 컨테이너, 즉 애플리케이션 컨텍스트는 바로 이 BeanDefinition으로 만들어진 메타정보를 담은 오브젝트를 사용해 IoC와 DI 작업을 수행한다.
- 따라서 스프링의 메타정보는 특정한 파일 포맷이나 형식에 제한되거나 종속되지 않는다. 원본의 포맷과 구조, 자료의 특성에 맞게 읽어와 BeanDefinition으로 변환해주는 BeanDefinitionReader가 있으면 된다.
<br><br>
- BeanDefinition 인터페이스로 정의되는, IoC 컨테이너가 사용하는 빈 메타정보는 대략 다음과 같다.
  - 빈 아이디, 이름, 별칭: 빈 오브젝트를 구분할 수 있는 식별자
  - 클래스 또는 클래스 이름: 빈으로 만들 POJO 클래스 또는 서비스 클래스 정보
  - 스코프: 싱글톤, 프로토타입과 같은 빈의 생성 방식과 존재 범위
  - 프로퍼티 값 또는 참조: DI에 사용할 프로퍼티 이름과 값 또는 참조하는 빈의 이름
  - 생성자 파라미터 값 또는 참죄 DI에 사용할 생성자 파라미터 이름과 값 또는 참조할 빈의 이름
  - 지연된 로딩 여부, 우선 빈 여부, 자동와이어링 여부, 부모 빈 정보, 빈팩토리 이름 등
- 각 빈에 대한 정보를 담은 설정 메타정보를 읽어들임 &rarr; 이를 참고해서 빈 오브젝트 생성, 프로퍼티나 생성자를 통해 의존 오브젝트를 주입해주는 DI 작업 수행
- IoC 컨테이너가 관리하는 빈은 오브젝트 단위지 클래스 단위가 아니라는 사실을 기억해야 한다.
- 같은ㅇ 클래스의 빈을 여러 개 등록하는 이유는 빈마다 다른 설정을 지정해둑도 사용하기 위해서다.

- BeanDefinition을 이용한 빈 등록

- 두 번째 Hello 클래스 빈

## 1.1.2 IoC 컨테이너의 종류와 사용 방법
### 1. StaticApplicationContext
- 코드를 통해 빈 메타정보를 등록하기 위해 사용한다.
- 스프링의 기능에 대한 학습 테스트를 만들 때를 제외하ㅣ면 실제로 사용되지 않는다.
- 이런 스태틱 애플리케이션 컨테이너는 실전에서 사용하면 안 된다. 테스트 목적으로 코드를 통해 빈을 등록하고 컨테이너가 어떻게 동작하는지 확인하고 싶을 때를 대비해 이런 컨테이너가ㅓ 있다는 정보만 기억해두자.

### 2. GenericApplicationContext
- 가장 일반적인 애플리케이션 컨텍스트의 구현 클래스다.
- 실전에서 사용될 수 있는 모든 기능을 갖추고 있는 애플리케이션 컨텍스트다.
- 컨테이너의 주요 기능을 DI를 통해 확장할 수 있도록 설계되어 있다.
- XML 파일과 같은 외부의 리소스에 있는 빈 설정 메타정보를 리더를 통해 읽어들여서 메타정보로 전환해서 사용한다.
- 빈 설정 리더를 여러 개 사용해서 여러 리소스로부터 설정 메타정보를 읽어들이게도 할 수 있다. 모든 설정 메타정보를 가져온 후에 `refresh()` 메소드를 한 번 호출해서 애플리케이션 컨텍스트가 필요한 초기화 작업을 수행하게 해주면 된다.
- 스프링 컨테이너 자체를 확장해서 새로운 프레임워크를 만들거나, 스프링을 사용하는 독립형 애플리케이션을 만들지 않는 한 GenericApplicationContext를 직접 이용할 일은 없을 것이다.
- 하지만 GenericApplicationContext는 코드엥서 직접 만들고 초기화하지 않을 뿐이지 JUnit 테스트 등으로 실제로 자주 사용된다.

### 3. GenericXmlApplicationContext
- XmlBeanDefinitionReader를 내장하고 있기 때문에 XML 파일을 읽어들이고 `refresh()`를 통해 초기화하는 것까지 한 줄로 끝낼 수 있다.
- XML 파일로 설정을 만들고 애플리케이션 컨텍스트에서 XML을 읽어서 사용하는 코드를 시험 삼아 만들어볼 필요가 있다면 사용하기에 적당하다.

### 4. WebApplicationContext
- 스프링 애플리케이션에서 가장 많이 사용되는 애플리케이션 컨텍스트
- 이름 그대로 웹 환경에서 사용할 대 필요한 기능이 추가된 애플리케이션 컨텍스트다. 스프링 애플리케이션은 대부분 서블릿 기반의 독립 웹 애플리케이션(WAR)으로 만들어지기 때문이다.
- 웹 애플리케이션에서 스프링 애플리케이션을 기동시키는 방법
  - 일단 `main()` 메소드 역할을 하는 서블릿을 만들어두고
  - 미리 애플리케이션에서 컨텍스트를 생성해둔 다음
  - 요청이 서블릿으로 들어올 때마다 `getBean()`으로 필요한 빈을 가져와 정해진 메소드를 가져와 정해진 메소드를 실행해주면 된다.
  - [웹 환경에서 스프링 애플리케이션이 기동하는 방식]
  - ![image](https://github.com/user-attachments/assets/4fa324e3-bb05-4591-b185-665b7a81082b)
- 스프링은 이런 웹 환경에서 애플리케이션 컨텍스트를 생성하고 설정 메타정보로 초기화해주고, 클라이언트로부터 들어오는 요청마다 적절한 빈을 찾아서 이를 실행해주는 기능을 가진 DispatcherServlet이라는 이름의 서블릿을 제공한다.
- WebApplicationContext의 특징은 자신이 만들어지고 동작하는 환경인 웹 모듈에 대한 정보에 접근할 수 있다는 점이다. 이를 이용해 웹 환경으로부터 필요한 정보를 가져오거나, 웹 환경에 스프링 컨테이너 자신을 노출할 수 있다. 컨테이너가 웹 환경에 노출되면 웹 모듈에 들어 있는 스프링 빈이 아닌 일반 오브젝트와 연동될 수 있다.

## 1.1.3 IoC 컨테이너 계층구조
### 부모 컨텍스트를 이용한 계층구조 효과
- [컨테이너 계층구조]
![image](https://github.com/user-attachments/assets/ec03279c-eb4b-4241-92ff-0e1bcb00100f)
- 모든 애플리케이션 컨텍스트는 부모 애플리케이션 컨텍스트를 가질 수 있다.
- 계층구조 안의 모든 컨텍스트는 각자 독립적인 설정정보를 이용해 빈 오브젝트를 만들고 관리한다.
- 각자 독립적으로 자신이 관리하는 빈을 갖고 있긴 하지만 DI를 위해 빈을 찾을 때는 부모 애플리케이션 컨텍스트의 빈까지 모두 검색한다.
- 먼저 자신이 관리하는 빈 중에서 필요한 빈을 찾아보고, 없으면 부모 컨텍스트에게 빈을 찾아달라고 요청한다.
- 부모에게서도 찾을 수 없다면 부모의 부모 컨텍스트에게 다시 요청. 이러한 계층구조를 따라서 가장 위에 존재하는 루트 컨텍스트까지 요청이 전달된다.
- 중요한 건 자신의 부모 컨텍스트에게만 빈 검색을 요청하지 자식 컨텍스트에게는 요청하지 않는다는 점이다. &rarr; 같은 레벨에 있는 형제 컨텍스트의 빈도 찾을 수 없다. 형제가 갖고 있더라도 자신의 직계, 루트한테서 검색되지 않는다면 빈 검색을 포기한다.

## 1.1.4 웹 애플리케이션의 IoC 컨테이너 구성
- 서버에서 동작하는 애플리케이션에서 스프링 IoC 컨테이너를 사용하는 방법은 크게 세 가지로 구분해볼 수 있다.
  - 1,2: 웹 모듈 안에 컨테이너를 두는 방법
    - 스프링 애플리케이션의 요청을 처리하는 서블릿 안에서 만들어지는 것
    - 웹 애플리케이션 레벨에서 만들어지는 것
  - 3: 엔터프라이즈 애플리케이션 레벨에 두는 방법

### 웹 애플리케이션의 컨텍스트 계층구조
- 루트 웹 애플리케이션 컨텍스트: 웹 애플리케이션 레벨에 등록되는 컨테이너
- 일반적으로는 스프링의 애플리케이션 컨텍스트를 가지면서 프론트 컨트롤러 역할을 하는 서블릿은 하나만 만들어 사용한다.
- 전체 애플리케이션에서 웹 기술에 의존적인 부분과 그렇지 않은 부분을 구분하기 위해 계층구조로 만든다.
- [스프링 웹 애플리케이션의 다양한 구성 방법]
- ![image](https://github.com/user-attachments/assets/fcb7ee93-c51c-4295-9ffc-13583bc6128d)
  - 이렇게 프레젠테이션 계층을 분리해서 계층구조로 ㅐㅇ플리케이션 컨텍스트를 구성해두면 언제든 간단히 웹 기술을 확장하거나 변경, 조합해서 사용할 수 있으므로 당장에는 스프링 서블릿 한 가지만 존재한다고 해도 이런 계층구조로 만들어두는 것이 권장된다.
  - 주의
    - 서블릿의 컨텍스트 빈은 루트 애플리케이션 컨텍스트의 빈을 참조할 수 있지만 그 반대는 안 된다.
    - 또한 루트 컨텍스트에 정의된 빈은 이름이 같은 서블릿 컨텍스트의 빈이 존재하면 무시될 수 있다.
    - 하나의 컨텍스트에 정의된 AOP 설정은 다른 컨텍스트의 빈에는 영향을 미치지 않는다는 점도 주의해야 한다.

### 웹 애플리케이션의 컨텍스트 구성 방법
- 서블릿 컨텍스트와 루트 애플리케이션 컨텍스트 계층구조
  - 가장 많이 사용되는 기본적인 구성 방법
  - 스프링 웹 기술을 사용하는 경우 웹 관련 빈들은 서블릿의 컨텍스트에 두고 나머지는 루트 애플리케이션 컨텍스트에 등록한다.
- 루트 애플리케이션 컨텍스트 단일구조
  - 스프링 웹 기술을 사용하지 않고 서드파티 웹 프레임워크나 서비스 엔진만을 사용해서 프레젠테이션 계층을 만들 때 사용한다.
  - 서블릿의 애플리케이션 컨텍스트도 사용하지 않게 된다.
- 서블릿 컨텍스트 단일구조
  - 스프링 웹 기술을 사용하면서 스프링 외의 프레임워크나 서비스 엔진에서 스프링의 빈을 이용할 생각이 아니라면 루트 애플리케이션 컨텍스트를 생략할 수도 있다.